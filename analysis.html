<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Analysis Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .chart-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-card {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #34495e;
            color: white;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        .canvas-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        #loadingMessage {
            text-align: center;
            padding: 20px;
            font-size: 18px;
            color: #2c3e50;
        }

        #errorMessage {
            text-align: center;
            padding: 20px;
            font-size: 18px;
            color: #e74c3c;
            display: none;
        }

        .grade-distribution {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Student Analysis Dashboard</h1>
        </div>

        <div id="loadingMessage">Loading student data...</div>
        <div id="errorMessage">Error loading data. Please check the console for details.</div>

        <div id="dashboardContent" style="display: none;">
            <div class="stats-container">
                <div class="stat-card">
                    <h3>Total Students</h3>
                    <p id="totalStudents">-</p>
                </div>
                <div class="stat-card">
                    <h3>Pass Rate</h3>
                    <p id="passRate">-</p>
                </div>
                <div class="stat-card">
                    <h3>Male Students</h3>
                    <p id="maleStudents">-</p>
                </div>
                <div class="stat-card">
                    <h3>Female Students</h3>
                    <p id="femaleStudents">-</p>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-card">
                    <h3>Gender Distribution</h3>
                    <div class="canvas-container">
                        <canvas id="genderChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Pass/Fail Distribution</h3>
                    <div class="canvas-container">
                        <canvas id="passFailChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="chart-card">
                <h3>Department-wise Statistics</h3>
                <div class="canvas-container">
                    <canvas id="departmentChart"></canvas>
                </div>
            </div>

            <div class="chart-card grade-distribution">
                <h3>Grade Distribution</h3>
                <div class="canvas-container">
                    <canvas id="gradeDistributionChart"></canvas>
                </div>
            </div>

            <div class="stat-card">
                <h3>Detailed Department Analysis</h3>
                <table id="departmentTable">
                    <thead>
                        <tr>
                            <th>Department</th>
                            <th>Total Students</th>
                            <th>Passed</th>
                            <th>Failed</th>
                            <th>Pass Rate</th>
                            <th>Avg. Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <div class="chart-card">
                <h3>Sports Activity vs. Academic Performance</h3>
                <div class="canvas-container">
                    <canvas id="sportsChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3>Attendance vs. Performance</h3>
                <div class="canvas-container">
                    <canvas id="attendanceChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Main analysis function
        async function analyzeStudentData() {
            try {
                // For this demo, we'll simulate loading the CSV data
                // In a real application, you would use fetch or another method to load the data
                const csvData = `NAME,AGE,GENDER,DEPARTMENT,ROLL NO,SUB 1,SUB 2,SUB 3,SUB 4,SUB 5,ATTENDANCE PERSENTAGE,SPORTS ACTIVITIES
Adhira,21,female,Computer Science,1001,70,87,85,92,88,92%,yes 
adhi,22,male,Botany,121,93,87,86,23,96,87%,no
Meera,21,female,Chemistry,1111,76,77,88,76,80,83%,no
krishna,22,male,Botany,122,70,63,55,23,78,90%,yes 
Asha,22,female,Economics,200,85,86,92,88,81,82%,no
dilip,23,male,Computer Science,1002,57,54,52,67,83,86%,yes 
Isha,21,female,Chemistry,1112,83,80,78,98,95,93%,no
Kaviya,23,female,Botany,123,61,58,23,78,34,79%,no
kumar,24,male,Economics,201,75,73,67,90,82,85%,yes 
Madhu,22,female,Computer Science,1003,69,23,56,67,80,87%,yes 
sakthi,21,male,Economics,202,69,69,47,56,86,88%,yes 
gopi,22,male,Chemistry,1113,50,49,31,79,87,94%,no
karthick,23,male,Economics,203,74,76,67,93,93,91%,no
vinoth,22,male,Computer Science,1004,73,70,45,84,95,83%,yes 
murugan,21,male,Economics,204,12,52,56,76,97,92%,yes 
pushpa,23,male,Chemistry,1114,46,24,67,92,99,87%,yes 
Nivetha,21,female,Economics,205,23,41,89,88,95,83%,yes 
Manju,23,female,Computer Science,1005,92,81,43,59,82,90%,no
Malathi,22,female,Economics,206,82,85,12,66,72,82%,no
Bharathi,22,female,Botany,124,71,74,98,91,98,86%,yes 
raj,23,male,Chemistry,1115,66,62,97,13,95,93%,no
cecilia,22,female,Economics,207,71,76,67,69,83,79%,yes 
divya,21,female,Computer Science,1006,23,71,78,70,81,85%,yes 
ragul,23,male,Economics,208,18,86,79,76,91,87%,no
venkat,24,male,Botany,125,85,88,69,70,23,88%,no
ravi,22,male,Chemistry,1117,83,72,94,69,95,94%,yes 
rishi,21,male,Economics,209,52,41,82,53,87,91%,no
siva,23,male,Computer Science,1007,66,59,90,60,88,83%,yes 
Ester,23,female,Statistics,101,79,71,49,49,77,92%,no
tamizh,22,male,Botany,126,87,86,83,75,75,87%,no
Gowri,21,female,Chemistry,1118,81,85,77,79,84,83%,yes 
Kanmani,23,female,Statistics,102,76,79,68,55,81,90%,no
Lakshmi,24,female,Computer Science,1008,78,75,55,40,75,82%,no
Nisha,22,female,Statistics,103,35,37,99,99,94,86%,no
Vishnu,21,male,Statistics,104,82,82,38,78,85,93%,yes 
Priya,21,female,Botany,127,53,54,60,51,76,79%,yes 
Priyanka,24,female,Computer Science,1009,74,75,70,91,77,85%,yes 
Naveen,23,male,Statistics,105,66,72,58,60,88,87%,no
Siddharth,22,male,Computer Science,1010,85,87,57,75,99,88%,no
Varun,22,male,Chemistry,1119,85,78,98,84,68,94%,no
Anand,22,male,Statistics,106,46,48,87,95,48,91%,no
Mohan,24,male,Botany,128,82,77,76,83,67,83%,no
Mithran,23,male,Statistics,107,82,72,65,75,87,83%,yes 
Kartik,21,male,Chemistry,1110,73,67,54,53,67,82%,no
Ramya,21,female,Computer Science,1011,56,54,43,82,76,84%,no
Vikram,23,male,Computer Science,1012,71,65,32,66,91,80%,yes 
Nikhil,23,male,Chemistry,1011,82,90,56,85,90,91%,yes 
Yuvraj,21,male,Botany,129,76,68,78,95,80,89%,no
Sandhiya,23,female,Computer Science,1013,52,56,90,98,92,80%,no
Paul,22,male,Computer Science,1234,73,81,93,97,63,67%,yes 
Danielle,23,female,Botany,1235,90,82,96,100,90,54%,no
Tina,21,female,Chemistry,1236,81,83,95,96,65,65%,yes 
Tara,21,female,Botany,1237,71,84,88,80,89,90%,yes 
Anthony,23,male,Economics,1238,84,85,65,65,80,68%,yes 
Kelly,23,female,Computer Science,1239,93,86,67,78,72,56%,no
Anthony,22,male,Chemistry,1230,99,87,97,73,88,81%,no
George,20,male,Botany,1212,95,88,82,63,84,82%,no
Stanley,23,male,Economics,1213,94,89,94,85,81,83%,no
Audrey,21,female,Computer Science,1214,98,90,88,71,67,84,no
Gabrielle,22,female,Economics,1215,65,91,97,94,71,85,yes 
Clinton,22,male,Chemistry,1216,80,92,100,65,87,86,yes 
Patricia,23,female,Economics,1217,94,93,69,67,89,87,yes 
Pamela,23,female,Computer Science,1218,66,94,86,100,57,88,no
Laura,23,female,Economics,1219,96,95,86,92,92,89,yes 
Roger,23,male,Chemistry,1220,94,96,78,64,79,90,no
Vicki,22,female,Economics,1221,92,97,93,91,80,91,no
Maxwell,22,male,Computer Science,1222,86,98,85,79,93,92,no
Jonathan,21,male,Economics,1223,92,99,92,99,97,93,no
Angela,21,female,Botany,1224,99,100,98,75,66,94,yes 
Tim,21,male,Chemistry,1225,100,67,72,98,73,95,yes 
Kyle,23,male,Economics,1226,57,78,78,94,83,96,yes 
Shannon,22,female,Computer Science,1227,89,87,68,72,71,97,no
Sean,21,male,Economics,1228,50,98,81,23,56,98,yes 
Cassandra,21,female,Botany,1229,87,87,90,88,95,99,yes 
Patricia,23,female,Chemistry,1230,92,89,87,81,93,100,yes 
Jason,23,male,Economics,1231,100,95,80,94,63,67,no
Peter,21,male,Computer Science,1232,64,76,93,79,81,78,no
Jeffrey,21,male,Statistics,1233,23,90,99,71,76,87,yes 
Carol,22,female,Botany,1234,82,80,61,97,30,98,yes 
Angie,22,female,Chemistry,1235,88,70,87,100,88,87,no
Cynthia,22,female,Statistics,1236,70,60,92,74,82,89,no
Timothy,21,male,Computer Science,1237,77,89,98,89,85,92,no
Phyllis,22,female,Statistics,1238,99,99,84,78,78,95,yes 
Lisa,23,female,Statistics,1239,23,88,91,80,86,87,yes 
Kelly,23,female,Botany,1240,65,77,78,98,80,82,yes 
Ryan,22,male,Computer Science,1241,99,56,87,23,89,83,yes 
Michael,21,male,Statistics,1242,92,45,85,89,81,65,no
Miguel,20,male,Computer Science,1243,77,78,64,88,94,84,no
Christopher,20,male,Chemistry,1244,92,90,66,87,60,86,yes 
Emily,23,female,Statistics,1245,85,56,64,90,23,89,yes 
Jesus,23,male,Botany,1246,23,78,66,50,88,93,no
Lauren,21,female,Statistics,1247,93,77,92,77,87,90,yes 
Pamela,23,female,Chemistry,1248,97,98,85,96,91,80,yes 
David,22,male,Computer Science,1249,54,96,79,57,53,92,yes 
Kenneth,21,male,Computer Science,1250,88,99,50,58,84,91,yes 
Elizabeth,23,female,Chemistry,1251,71,78,93,68,100,93,yes 
Billy,22,male,Botany,1252,81,67,74,23,97,94,no
Kimberly,22,female,Computer Science,1253,23,78,86,80,64,83,yes 
Sonia,21,female,Computer Science,1254,98,97,94,93,94,96,yes 
madhu,22,female,Statistics,1255,87,78,90,92,56,89,no`;
                
                // Parse the CSV data
                const results = Papa.parse(csvData, {
                    header: true,
                    skipEmptyLines: true,
                    transformHeader: header => header.trim(),
                    transform: value => value.trim()
                });
                
                if (results.errors.length > 0) {
                    console.error("CSV Parsing Errors:", results.errors);
                    throw new Error("Error parsing CSV data");
                }
                
                const students = results.data;
                
                // Clean and convert numeric data
                // Clean and convert numeric data
students.forEach(student => {
    // Convert subject scores to numbers
    student['SUB 1'] = parseInt(student['SUB 1']) || 0;
    student['SUB 2'] = parseInt(student['SUB 2']) || 0;
    student['SUB 3'] = parseInt(student['SUB 3']) || 0;
    student['SUB 4'] = parseInt(student['SUB 4']) || 0;
    student['SUB 5'] = parseInt(student['SUB 5']) || 0;
    
    // Calculate average score
    student.averageScore = (
        student['SUB 1'] + 
        student['SUB 2'] + 
        student['SUB 3'] + 
        student['SUB 4'] + 
        student['SUB 5']
    ) / 5;
    
    // Determine if student passed (average >= 80)
    student.passed = student.averageScore >= 80;
    
    // Convert attendance percentage to number
    student.attendance = parseInt(student['ATTENDANCE PERSENTAGE']) || 0;
    
    // Standardize gender values
    student.GENDER = student.GENDER.toLowerCase().trim();
    
    // Standardize sports activity values
    student['SPORTS ACTIVITIES'] = student['SPORTS ACTIVITIES'].toLowerCase().trim();
    student.sportParticipant = student['SPORTS ACTIVITIES'].includes('yes');
    
    // Assign grade based on average score
    if (student.averageScore >= 90) student.grade = 'A+';
    else if (student.averageScore >= 80) student.grade = 'A';
    else if (student.averageScore >= 70) student.grade = 'B';
    else if (student.averageScore >= 60) student.grade = 'C';
    else if (student.averageScore >= 50) student.grade = 'D';
    else if (student.averageScore >= 35) student.grade = 'E';
    else student.grade = 'F';
});
                
                // Basic statistics
                const totalStudents = students.length;
                const maleStudents = students.filter(s => s.GENDER === 'male').length;
                const femaleStudents = students.filter(s => s.GENDER === 'female').length;
                const passedStudents = students.filter(s => s.passed).length;
                const passRate = ((passedStudents / totalStudents) * 100).toFixed(2);
                
                // Update basic statistics in the dashboard
                document.getElementById('totalStudents').textContent = totalStudents;
                document.getElementById('maleStudents').textContent = maleStudents;
                document.getElementById('femaleStudents').textContent = femaleStudents;
                document.getElementById('passRate').textContent = `${passRate}%`;
                
                // Prepare department statistics
                const departments = [...new Set(students.map(s => s.DEPARTMENT))];
                const departmentStats = departments.map(dept => {
                    const deptStudents = students.filter(s => s.DEPARTMENT === dept);
                    const deptPassed = deptStudents.filter(s => s.passed).length;
                    const deptFailed = deptStudents.length - deptPassed;
                    const deptPassRate = ((deptPassed / deptStudents.length) * 100).toFixed(2);
                    const deptAvgScore = deptStudents.reduce((sum, s) => sum + s.averageScore, 0) / deptStudents.length;
                    
                    return {
                        department: dept,
                        totalStudents: deptStudents.length,
                        passed: deptPassed,
                        failed: deptFailed,
                        passRate: deptPassRate,
                        avgScore: deptAvgScore.toFixed(2)
                    };
                });
                
                // Populate department table
                const tableBody = document.getElementById('departmentTable').querySelector('tbody');
                departmentStats.forEach(stat => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${stat.department}</td>
                        <td>${stat.totalStudents}</td>
                        <td>${stat.passed}</td>
                        <td>${stat.failed}</td>
                        <td>${stat.passRate}%</td>
                        <td>${stat.avgScore}</td>
                    `;
                    tableBody.appendChild(row);
                });
                
                // Create charts
                createGenderChart(maleStudents, femaleStudents);
                createPassFailChart(passedStudents, totalStudents - passedStudents);
                createDepartmentChart(departmentStats);
                createGradeDistributionChart(students);
                createSportsPerformanceChart(students);
                createAttendanceChart(students);
                
                // Show dashboard content and hide loading message
                document.getElementById('loadingMessage').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'block';
                
            } catch (error) {
                console.error("Error analyzing student data:", error);
                document.getElementById('loadingMessage').style.display = 'none';
                document.getElementById('errorMessage').style.display = 'block';
            }
        }
        
        // Create gender distribution chart
        function createGenderChart(male, female) {
            new Chart(document.getElementById('genderChart'), {
                type: 'pie',
                data: {
                    labels: ['Male', 'Female'],
                    datasets: [{
                        data: [male, female],
                        backgroundColor: ['#3498db', '#e74c3c']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        // Create pass/fail distribution chart
        function createPassFailChart(passed, failed) {
            new Chart(document.getElementById('passFailChart'), {
                type: 'pie',
                data: {
                    labels: ['Pass', 'Fail'],
                    datasets: [{
                        data: [passed, failed],
                        backgroundColor: ['#2ecc71', '#e74c3c']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        // Create department-wise statistics chart
        function createDepartmentChart(departmentStats) {
            const departments = departmentStats.map(d => d.department);
            const passedData = departmentStats.map(d => d.passed);
            const failedData = departmentStats.map(d => d.failed);
            
            new Chart(document.getElementById('departmentChart'), {
                type: 'bar',
                data: {
                    labels: departments,
                    datasets: [{
                        label: 'Passed',
                        data: passedData,
                        backgroundColor: '#2ecc71'
                    }, {
                        label: 'Failed',
                        data: failedData,
                        backgroundColor: '#e74c3c'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Create grade distribution chart
        function createGradeDistributionChart(students) {
            const grades = ['A+', 'A', 'B', 'C', 'D', 'E', 'F'];
            const gradeCounts = grades.map(grade => 
                students.filter(student => student.grade === grade).length
            );
            
            new Chart(document.getElementById('gradeDistributionChart'), {
                type: 'bar',
                data: {
                    labels: grades,
                    datasets: [{
                        label: 'Number of Students',
                        data: gradeCounts,
                        backgroundColor: [
                            '#1abc9c', '#2ecc71', '#3498db', 
                            '#9b59b6', '#f1c40f', '#e67e22', '#e74c3c'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Create sports vs performance chart
        function createSportsPerformanceChart(students) {
            const sportStudents = students.filter(s => s.sportParticipant);
            const nonSportStudents = students.filter(s => !s.sportParticipant);
            
            const sportAvg = sportStudents.reduce((sum, s) => sum + s.averageScore, 0) / sportStudents.length;
            const nonSportAvg = nonSportStudents.reduce((sum, s) => sum + s.averageScore, 0) / nonSportStudents.length;
            
            new Chart(document.getElementById('sportsChart'), {
                type: 'bar',
                data: {
                    labels: ['Sports Participants', 'Non-Participants'],
                    datasets: [{
                        label: 'Average Score',
                        data: [sportAvg.toFixed(2), nonSportAvg.toFixed(2)],
                        backgroundColor: ['#3498db', '#95a5a6']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }
        
        // Create attendance vs performance scatter plot
        function createAttendanceChart(students) {
            const data = students.map(student => ({
                x: student.attendance,
                y: student.averageScore
            }));
            
            new Chart(document.getElementById('attendanceChart'), {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Attendance vs Score',
                        data: data,
                        backgroundColor: '#3498db'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Attendance (%)'
                            },
                            min: 0,
                            max: 100
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Average Score'
                            },
                            min: 0,
                            max: 100
                        }
                    }
                }
            });
        }
        
        // Initialize the dashboard
        window.onload = function() {
            analyzeStudentData();
        };
    </script>
</body>
</html>